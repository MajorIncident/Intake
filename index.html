<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KT Intake</title>

<!-- Link external CSS -->
<link rel="stylesheet" href="styles.css" />
<!--
KT Intake is a single-file Kepner-Tregoe intake workbook. It renders all UI, logic,
and persistence helpers for the zero-backend workflow described in README.md. See
README.md and AGENTS.md for contributor guidance.

Editing contract summary: preserve anchor comments, keep tokens such as {OBJECT}
and {DEVIATION}, and retain the names of core functions (init, initTable,
initStepsFeature, generateSummary, buildSummaryText). Additional contract details
follow below.

[contract] start
EDITING CONTRACT for ChatGPT & humans:
- Keep these anchors intact. Prefer unified diffs (*** Begin Patch / *** End Patch) that edit INSIDE the relevant anchors only.
- Do not remove tokens: {OBJECT} / {DEVIATION}.
- Keep function names/signatures for copy to ASCII intact.
- Avoid structural rewrites unless requested; keep single-file layout.
Anchors present:
  [styles] [vars] [header] [section:preface] [subtitle]
  [section:impact] [section:table]
  [script] [rows] [script:table-build] [script:preface-refs]
  [script:tokens] [script:init] [script:export] [script:storage] [script:toast]
[contract] end
-->

<!-- Styles and layout definitions for the full intake workbook UI. -->
<!-- [styles] start -->
<!-- [styles] extracted to styles.css -->
<!-- [styles] end -->
</head>
<body>
  <!-- Header: global controls for steps drawer and summary generation. -->
  <!-- [header] start -->
  <header>
    <div class="header-title">
      <h1 id="docTitle">KT Intake</h1>
    </div>
    <div class="header-actions">
      <button type="button" class="steps-button" id="commsBtn" aria-haspopup="dialog" aria-controls="commsDrawer" aria-expanded="false">
        <span>Comms</span>
        <span class="shortcut">Alt+C</span>
      </button>
      <button type="button" class="steps-button" id="stepsBtn" aria-haspopup="dialog" aria-controls="stepsDrawer" aria-expanded="false">
        <span>Steps</span>
        <span class="shortcut">Alt+S</span>
      </button>
      <span class="steps-badge" id="stepsCompletedLabel" aria-live="polite">0 of 28</span>
      <button class="btn" id="genSummaryBtn" onclick="onGenerateSummary()">Generate Summary</button>
    </div>
  </header>
  <!-- [header] end -->

  <div class="wrap">
    <!-- Preface cards: summary headline, detection inputs, and baseline. Bridge activation fields now live in the Comms drawer. -->
    <!-- [section:preface] start -->
    <section class="preface-stack">
      <div class="drawer-placeholder" aria-hidden="true"></div>

      <div class="card" id="problem-summary">
        <h3>Problem Summary</h3>
        <div class="grid">
          <div class="field">
            <label for="oneLine">In one sentence, what is broken for you right now?</label>
            <textarea id="oneLine" placeholder=""></textarea>
          </div>
        </div>
      </div>

      <div class="card" id="evidence-objects">
        <h3>Evidence &amp; Object</h3>
        <div class="inline">
          <span class="chip-label">Detection Source</span>
          <div class="chipset" role="group" aria-label="Detection Source">
            <div class="chip">
              <input type="checkbox" id="detectMonitoring" />
              <label for="detectMonitoring">Monitoring</label>
            </div>
            <div class="chip">
              <input type="checkbox" id="detectUserReport" />
              <label for="detectUserReport">User Report</label>
            </div>
            <div class="chip">
              <input type="checkbox" id="detectAutomation" />
              <label for="detectAutomation">Automation</label>
            </div>
            <div class="chip">
              <input type="checkbox" id="detectOther" />
              <label for="detectOther">Other</label>
            </div>
          </div>
        </div>
        <div class="inline">
          <span class="chip-label">Evidence Collected</span>
          <div class="chipset" role="group" aria-label="Evidence Collected">
            <div class="chip">
              <input type="checkbox" id="evScreenshot" />
              <label for="evScreenshot">Screenshot</label>
            </div>
            <div class="chip">
              <input type="checkbox" id="evLogs" />
              <label for="evLogs">Logs</label>
            </div>
            <div class="chip">
              <input type="checkbox" id="evMetrics" />
              <label for="evMetrics">Metrics</label>
            </div>
            <div class="chip">
              <input type="checkbox" id="evRepro" />
              <label for="evRepro">Repro</label>
            </div>
            <div class="chip">
              <input type="checkbox" id="evOther" />
              <label for="evOther">Other</label>
            </div>
          </div>
        </div>
        <div class="grid cols-2">
          <div class="field">
            <label for="proof">What proves a deviation exists?</label>
            <small>Examples: alerts, error messages, metric spikes/drops, log lines, screenshots, reproducible steps.</small>
            <textarea id="proof" placeholder=""></textarea>
          </div>
          <div class="field">
            <label for="objectPrefill">What is the specific object being affected?</label>
            <small>Hardware name and model, Function/Module/Method, Container/Service/API, datastore/volume/bucket/table, network element, identity/policy/role, pipeline/job.</small>
            <textarea id="objectPrefill" placeholder=""></textarea>
          </div>
        </div>
      </div>

      <div class="card" id="baseline-current">
        <h3>Baseline vs Current</h3>
        <div class="grid cols-2">
          <div class="field">
            <label id="labelHealthy" for="healthy">What does healthy look like here?</label>
            <small>What was the expected behavior?</small>
            <textarea id="healthy" placeholder=""></textarea>
          </div>
          <div class="field">
            <label id="labelNow" for="now">What is happening now?</label>
            <small>What has been verified and measured vs same baseline (same metrics as above)? What symptom is being presented?</small>
            <textarea id="now" placeholder=""></textarea>
          </div>
        </div>
      </div>
    </section>
    <!-- [section:preface] end -->

    <!-- [subtitle] start -->
    <h2 id="docSubtitle">Describe The Problem</h2>
    <!-- [subtitle] end -->

    <!-- Impact, containment, and communications workflow section. -->
    <!-- [section:impact] start -->
    <div class="card impact">
      <h3>Impact</h3>
      <div class="grid cols-3 gap-24">
        <div class="field">
          <h3>Current Impact</h3>
          <label for="impactNow">Current Impact</label>
          <small>Who/what is affected now? Quantify: users/tenants/regions, transactions failing, SLI/SLO deltas (avail %, p95/p99, error %), data at risk (loss/corruption/exposure), workarounds.</small>
          <textarea id="impactNow" placeholder=""></textarea>
        </div>
        <div class="field">
          <h3>Future Impact</h3>
          <label for="impactFuture">Future Impact</label>
          <small>If unresolved what happens? Blast radius growth, SLO/SLA breach, revenue/penalties, compliance, backlog/consumer lag, churn, on-call fatigue.</small>
          <textarea id="impactFuture" placeholder=""></textarea>
        </div>
        <div class="field">
          <h3>Timeframe</h3>
          <label for="impactTime">Timeframe</label>
          <small>When will the Future Impact become Current Impact? (Best Estimate). What deadlines/SLAs do we need to be aware of?</small>
          <textarea id="impactTime" placeholder=""></textarea>
        </div>
      </div>
      <div class="grid cols-3 gap-24 containment-grid">
        <fieldset class="field contain-status">
          <legend>Containment Status</legend>
          <div class="containment-radios" role="radiogroup" aria-label="Containment Status">
            <div class="radio-option">
              <input type="radio" id="containNone" name="containStatus" value="none" />
              <label for="containNone">No action yet</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="containMitigation" name="containStatus" value="mitigation" />
              <label for="containMitigation">Temporary mitigation applied</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="containRestore" name="containStatus" value="restore" />
              <label for="containRestore">Full restoration in progress</label>
            </div>
          </div>
        </fieldset>
        <div class="field">
          <label for="containDesc">Containment Description</label>
          <input type="text" id="containDesc" placeholder="What immediate step reduces risk?" />
        </div>
      </div>
    </div>
    <!-- [section:impact] end -->

    <div class="drawer-placeholder" aria-hidden="true"></div>

    <!-- KT IS / IS NOT analysis table driven by ROWS tokens. -->
    <!-- [section:table] start -->
    <p class="subtle" id="kt-is-is-not">Problem Analysis</p>

    <table id="ktTable" aria-label="KT IS / IS NOT intake table">
<colgroup>
  <col style="width:18%;">
  <col style="width:21%;">
  <col style="width:21%;">
  <col style="width:20%;">
  <col style="width:20%;">
</colgroup>

      <thead>
        <tr>
          <th scope="col">KT Question</th>
          <th scope="col">IS <span class="subtle">— facts only</span></th>
          <th scope="col">IS NOT <span class="subtle">— similar &amp; reasonable and could be but is not occuring</span></th>
          <th scope="col">Distinctions <span class="subtle">— Unique characteristics about the IS</span></th>
          <th scope="col">Changes <span class="subtle">— Changes that happened in on around or about each Distinction</span></th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <!-- [section:table] end -->


    <div id="possible-causes" tabindex="-1"></div>
    <div class="card" id="possibleCausesCard">
      <h3>Possible Causes</h3>
      <p class="caption">Capture hypotheses and pressure test them against the KT IS / IS NOT evidence. Start with the suspect, accusation, and impact; then walk each cause through the table.</p>
      <div id="causeList" class="cause-list" aria-live="polite"></div>
      <div class="cause-controls">
        <button type="button" class="btn-mini" id="addCauseBtn">Add Possible Cause</button>
      </div>
    </div>


    <!-- Summary card showing the most recent export for manual copy. -->
    <!-- [section:summary] start -->
    <div class="card" id="summaryCard" style="display:none;">
      <h3>Copy &amp; Paste Summary</h3>
      <pre id="summaryPre" style="white-space:pre-wrap;font:13px/1.6 monospace;margin:0;"></pre>
    </div>
    <!-- [section:summary] end -->

  </div>

  <div class="comms-backdrop" id="commsBackdrop" aria-hidden="true"></div>
  <aside class="comms-drawer" id="commsDrawer" role="dialog" aria-modal="true" aria-labelledby="commsDrawerTitle" aria-hidden="true" tabindex="-1">
    <div class="comms-drawer__panel">
      <header class="comms-drawer__header">
        <div class="comms-drawer__title-group">
          <h2 class="comms-drawer__title" id="commsDrawerTitle">Bridge &amp; Communications</h2>
          <p class="comms-drawer__subtitle">Stamp bridge details, set cadence, and log incident updates.</p>
        </div>
        <button type="button" class="comms-drawer__close-btn" id="commsCloseBtn">Close</button>
      </header>
      <div class="comms-drawer__body">
        <section class="card comms-card">
          <h3>Bridge Activation</h3>
          <p class="caption">Capture only what’s needed to activate the bridge and set comms cadence.</p>
          <div class="grid cols-3">
            <div class="field">
              <label for="bridgeOpenedUtc">Bridge opened (UTC)</label>
              <div class="inline">
                <input type="text" id="bridgeOpenedUtc" readonly aria-readonly="true" />
                <button type="button" class="btn-mini" id="bridgeSetNowBtn" aria-label="Stamp bridge opened time">Set Now</button>
              </div>
            </div>
            <div class="field">
              <label for="icName">Incident Commander</label>
              <input type="text" id="icName" placeholder="" />
            </div>
            <div class="field">
              <label for="bcName">Bridge Coordinator</label>
              <input type="text" id="bcName" placeholder="" />
            </div>
          </div>
          <div class="grid cols-3">
            <div class="field">
              <label for="semOpsName">SEM/Ops Lead</label>
              <input type="text" id="semOpsName" placeholder="" />
            </div>
            <div class="field">
              <label for="severity">Severity</label>
              <select id="severity">
                <option value="">Select severity</option>
                <option value="S1">S1</option>
                <option value="S2">S2</option>
                <option value="S3">S3</option>
              </select>
            </div>
          </div>
        </section>
        <section class="card comms-card" id="commControlsCard">
          <h3>Communication Cadence &amp; Log</h3>
          <fieldset class="field" id="communication-cadence">
            <legend id="commCadenceLegend">Communication cadence</legend>
            <div class="cadence-group" id="commCadenceGroup" role="radiogroup" aria-labelledby="commCadenceLegend">
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="10" />
                <span>10 min</span>
              </label>
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="15" />
                <span>15 min</span>
              </label>
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="20" />
                <span>20 min</span>
              </label>
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="30" />
                <span>30 min</span>
              </label>
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="60" />
                <span>Hourly</span>
              </label>
            </div>
            <small>Pick how often updates should be broadcast. Logging a communication restarts the timer and reminder.</small>
          </fieldset>
          <div class="inline comm-actions">
            <button type="button" class="btn-mini" id="commInternalStampBtn" aria-label="Log internal communication">Log internal update</button>
            <button type="button" class="btn-mini" id="commExternalStampBtn" aria-label="Log external communication">Log external update</button>
            <button type="button" class="btn-mini" id="generateAiSummaryBtn" aria-label="Generate AI Summary">Generate AI Summary</button>
            <span class="countdown" id="commCountdown" aria-live="polite"></span>
          </div>
          <div class="comm-alert" id="commDueAlert" role="alert" hidden></div>
          <div class="grid comm-grid comm-grid--single">
            <div class="field">
              <label for="commNextUpdateTime">Next update scheduled for</label>
              <input type="time" id="commNextUpdateTime" />
            </div>
          </div>
          <div class="field" id="communication-log">
            <label for="commLogList">Communication log</label>
            <ul id="commLogList" class="comm-log" aria-live="polite" aria-label="Communication log"></ul>
            <button type="button" class="btn-mini comm-log-toggle" id="commLogToggleBtn" hidden aria-expanded="false">Show all</button>
          </div>
        </section>
      </div>
    </div>
  </aside>

  <div class="steps-backdrop" id="stepsBackdrop" aria-hidden="true"></div>
  <aside class="steps-drawer" id="stepsDrawer" role="dialog" aria-modal="true" aria-labelledby="stepsDrawerTitle" aria-hidden="true" tabindex="-1">
    <div class="steps-drawer__panel">
      <header class="steps-drawer__header">
        <div class="steps-drawer__title-row">
          <h3 class="steps-drawer__title" id="stepsDrawerTitle">Incident Steps</h3>
          <div class="steps-drawer__progress" id="stepsDrawerProgress">0 of 28 completed</div>
        </div>
      </header>
      <div class="steps-drawer__body" id="stepsList" role="group" aria-label="Incident steps checklist"></div>
      <footer class="steps-drawer__footer">
        <button type="button" class="steps-drawer__close-btn" id="stepsCloseBtn">Close</button>
      </footer>
    </div>
  </aside>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- Script: data models, event wiring, summary export, and persistence helpers. -->
<!-- [script] start -->
<!-- [script] extracted to main.js -->
<!-- [script] end -->
  <!-- External JavaScript -->
  <script type="module" src="main.js"></script>
</body>
</html>
