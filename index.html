<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KT Intake</title>

<!-- Link external CSS -->
<link rel="stylesheet" href="styles.css" />
<!--
KT Intake is a single-file Kepner-Tregoe intake workbook. It renders all UI, logic,
and persistence helpers for the zero-backend workflow described in README.md. See
README.md and AGENTS.md for contributor guidance.

Editing contract summary: preserve anchor comments, keep tokens such as {OBJECT}
and {DEVIATION}, and retain the names of core functions (init, initTable,
initStepsFeature, generateSummary, buildSummaryText). Additional contract details
follow below.

[contract] start
EDITING CONTRACT for ChatGPT & humans:
- Keep these anchors intact. Prefer unified diffs (*** Begin Patch / *** End Patch) that edit INSIDE the relevant anchors only.
- Do not remove tokens: {OBJECT} / {DEVIATION}.
- Keep function names/signatures for copy to ASCII intact.
- Avoid structural rewrites unless requested; keep single-file layout.
Anchors present:
  [styles] [vars] [header] [section:preface] [subtitle]
  [section:impact] [section:table]
  [script] [rows] [script:table-build] [script:preface-refs]
  [script:tokens] [script:init] [script:export] [script:storage] [script:toast]
[contract] end
-->

<!-- Styles and layout definitions for the full intake workbook UI. -->
<!-- [styles] start -->
<!-- [styles] extracted to styles.css -->
<!-- [styles] end -->
</head>
<body>
  <!-- Header: global controls for steps drawer and summary generation. -->
  <!-- [header] start -->
  <header>
    <div class="header-title">
      <h1 id="docTitle">KT Intake</h1>
    </div>
    <div class="header-actions">
      <button type="button" class="steps-button" id="commsBtn" aria-haspopup="dialog" aria-controls="commsDrawer" aria-expanded="false">
        <span>Comms</span>
        <span class="shortcut">Alt+C</span>
      </button>
      <button type="button" class="steps-button" id="stepsBtn" aria-haspopup="dialog" aria-controls="stepsDrawer" aria-expanded="false">
        <span>Steps</span>
        <span class="shortcut">Alt+S</span>
      </button>
      <span class="steps-badge" id="stepsCompletedLabel" aria-live="polite">0 of 28</span>
      <button type="button" class="btn" id="startFreshBtn" aria-label="Start a new intake">Start Fresh</button>
      <button type="button" class="btn-secondary" id="saveToFileBtn">Save to File</button>
      <input type="file" id="importFileInput" class="visually-hidden" accept="application/json,.json" />
      <button type="button" class="btn-secondary" id="loadFromFileBtn">Load from File</button>
      <button class="btn" id="genSummaryBtn" onclick="onGenerateSummary()">Generate Summary (Alt+G)</button>
    </div>
  </header>
  <!-- [header] end -->

  <div class="wrap">
    <!-- Preface cards: summary headline, detection inputs, and baseline. Bridge activation fields now live in the Comms drawer. -->
    <!-- [section:preface] start -->
    <section class="preface-stack">
      <div class="drawer-placeholder" aria-hidden="true"></div>

      <div class="card" id="problem-summary">
        <h3>Problem Summary</h3>
        <p class="card-subtitle">What’s broken — one sentence</p>
        <div class="grid">
          <div class="field field--with-subtext">
            <label for="oneLine">Describe the problem</label>
            <textarea id="oneLine" placeholder="" rows="2"></textarea>
            <div class="field-subtext-container">
              <button type="button" class="field-subtext-trigger" aria-label="Example: Describe the problem" aria-describedby="oneLine-subtext">
                <span aria-hidden="true">?</span>
              </button>
              <span id="oneLine-subtext" class="field-subtext" role="tooltip">Example: Checkout API returning 500s; users cannot complete purchases.</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card" id="evidence-objects">
        <h3>Evidence &amp; Object</h3>
        <div class="card-section">
          <div class="card-section-header">
            <h4>Evidence</h4>
            <p class="card-section-subtitle">Prove it exists</p>
          </div>
          <div class="inline">
            <span class="chip-label">Detection source</span>
            <div class="chipset" role="group" aria-label="Detection source">
              <div class="chip">
                <input type="checkbox" id="detectMonitoring" />
                <label for="detectMonitoring">Monitoring</label>
              </div>
              <div class="chip">
                <input type="checkbox" id="detectUserReport" />
                <label for="detectUserReport">User report</label>
              </div>
              <div class="chip">
                <input type="checkbox" id="detectAutomation" />
                <label for="detectAutomation">Automation</label>
              </div>
              <div class="chip">
                <input type="checkbox" id="detectOther" />
                <label for="detectOther">Other</label>
              </div>
            </div>
          </div>
          <div class="inline">
            <span class="chip-label">Evidence tags</span>
            <div class="chipset" role="group" aria-label="Evidence tags">
              <div class="chip">
                <input type="checkbox" id="evScreenshot" />
                <label for="evScreenshot">Screenshot</label>
              </div>
              <div class="chip">
                <input type="checkbox" id="evLogs" />
                <label for="evLogs">Logs</label>
              </div>
              <div class="chip">
                <input type="checkbox" id="evMetrics" />
                <label for="evMetrics">Metrics</label>
              </div>
              <div class="chip">
                <input type="checkbox" id="evRepro" />
                <label for="evRepro">Repro</label>
              </div>
              <div class="chip">
                <input type="checkbox" id="evOther" />
                <label for="evOther">Other</label>
              </div>
            </div>
          </div>
          <div class="grid">
            <div class="field field--with-subtext">
              <label for="proof">Show the evidence</label>
              <textarea id="proof" placeholder=""></textarea>
              <div class="field-subtext-container">
                <button type="button" class="field-subtext-trigger" aria-label="Examples: Show the evidence" aria-describedby="proof-subtext">
                  <span aria-hidden="true">?</span>
                </button>
                <span id="proof-subtext" class="field-subtext" role="tooltip">Examples: alerts, logs, metrics, screenshots, repro steps.</span>
              </div>
            </div>
          </div>
        </div>
        <div class="card-section">
          <div class="card-section-header">
            <h4>Object</h4>
            <p class="card-section-subtitle">What is affected</p>
          </div>
          <div class="field field--with-subtext">
            <label for="objectPrefill">Name the object</label>
            <textarea id="objectPrefill" placeholder=""></textarea>
            <div class="field-subtext-container">
              <button type="button" class="field-subtext-trigger" aria-label="Examples: Name the object" aria-describedby="objectPrefill-subtext">
                <span aria-hidden="true">?</span>
              </button>
              <span id="objectPrefill-subtext" class="field-subtext" role="tooltip">Be specific: service/module/container, cluster/region, role/policy, dataset/queue/topic.</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card" id="baseline-current">
        <h3>Baseline vs Current</h3>
        <p class="card-subtitle">Normal vs now</p>
        <div class="grid cols-2">
          <div class="field field--with-subtext">
            <label id="labelHealthy" for="healthy">Define normal</label>
            <textarea id="healthy" placeholder=""></textarea>
            <div class="field-subtext-container">
              <button type="button" class="field-subtext-trigger" aria-label="Example: Define normal" aria-describedby="healthy-subtext">
                <span aria-hidden="true">?</span>
              </button>
              <span id="healthy-subtext" class="field-subtext" role="tooltip">Example: Latency &lt;150 ms; error rate &lt;1%.</span>
            </div>
          </div>
          <div class="field field--with-subtext">
            <label id="labelNow" for="now">Describe now</label>
            <textarea id="now" placeholder=""></textarea>
            <div class="field-subtext-container">
              <button type="button" class="field-subtext-trigger" aria-label="Example: Describe now" aria-describedby="now-subtext">
                <span aria-hidden="true">?</span>
              </button>
              <span id="now-subtext" class="field-subtext" role="tooltip">Example: Latency &gt;3 s; error rate 27%; retries spiking.</span>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- [section:preface] end -->

    <!-- [subtitle] start -->
    <h2 id="docSubtitle">Describe The Problem</h2>
    <!-- [subtitle] end -->

    <!-- Impact, containment, and communications workflow section. -->
    <!-- [section:impact] start -->
    <div class="card impact">
      <h3>Impact</h3>
      <p class="card-subtitle">Who, how much, when</p>
      <div class="grid cols-3 gap-24">
        <div class="field field--with-subtext">
          <div class="field-group-header">
            <h4>Current Impact</h4>
            <p class="field-group-subtitle">Affected right now</p>
          </div>
          <label for="impactNow">Quantify impact</label>
          <textarea id="impactNow" placeholder=""></textarea>
          <div class="field-subtext-container">
            <button type="button" class="field-subtext-trigger" aria-label="Examples: Quantify impact" aria-describedby="impactNow-subtext">
              <span aria-hidden="true">?</span>
            </button>
            <span id="impactNow-subtext" class="field-subtext" role="tooltip">Users/regions/tenants, failed transactions, SLO/SLA deltas, data at risk, workarounds.</span>
          </div>
        </div>
        <div class="field field--with-subtext">
          <div class="field-group-header">
            <h4>Future Impact</h4>
            <p class="field-group-subtitle">If we do nothing</p>
          </div>
          <label for="impactFuture">Project risk</label>
          <textarea id="impactFuture" placeholder=""></textarea>
          <div class="field-subtext-container">
            <button type="button" class="field-subtext-trigger" aria-label="Examples: Project risk" aria-describedby="impactFuture-subtext">
              <span aria-hidden="true">?</span>
            </button>
            <span id="impactFuture-subtext" class="field-subtext" role="tooltip">Blast radius growth, penalties, backlog/churn, compliance exposure.</span>
          </div>
        </div>
        <div class="field field--with-subtext">
          <div class="field-group-header">
            <h4>Timeframe</h4>
            <p class="field-group-subtitle">Deadlines and SLAs</p>
          </div>
          <label for="impactTime">State deadlines</label>
          <textarea id="impactTime" placeholder=""></textarea>
          <div class="field-subtext-container">
            <button type="button" class="field-subtext-trigger" aria-label="Examples: State deadlines" aria-describedby="impactTime-subtext">
              <span aria-hidden="true">?</span>
            </button>
            <span id="impactTime-subtext" class="field-subtext" role="tooltip">When future impact becomes current; SLA breach times.</span>
          </div>
        </div>
      </div>
      <div class="grid cols-3 gap-24 containment-grid">
        <fieldset class="field contain-status field--with-subtext">
          <legend>Service Recovery Stage</legend>
          <p class="field-group-subtitle">Recovery status</p>
          <div class="field-subtext-container">
            <button type="button" class="field-subtext-trigger" aria-label="Tip: Service recovery stage" aria-describedby="containStatus-subtext">
              <span aria-hidden="true">?</span>
            </button>
            <span id="containStatus-subtext" class="field-subtext" role="tooltip">Pick one to align updates.</span>
          </div>
          <div class="containment-radios" role="radiogroup" aria-label="Service Recovery Stage">
            <div class="radio-option">
              <input type="radio" id="containAssessing" name="containStatus" value="assessing" />
              <label for="containAssessing">Assessing</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="containStoppingImpact" name="containStatus" value="stoppingImpact" />
              <label for="containStoppingImpact">Stopping the impact</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="containStabilized" name="containStatus" value="stabilized" />
              <label for="containStabilized">Stabilized/Workaround active</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="containFixInProgress" name="containStatus" value="fixInProgress" />
              <label for="containFixInProgress">Fix in progress</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="containRestoring" name="containStatus" value="restoring" />
              <label for="containRestoring">Restoring service</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="containMonitoring" name="containStatus" value="monitoring" />
              <label for="containMonitoring">Monitoring stability</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="containClosed" name="containStatus" value="closed" />
              <label for="containClosed">Closed</label>
            </div>
          </div>
        </fieldset>
        <div class="field containment-description field--with-subtext">
          <div class="field-group-header">
            <h4>Containment Description</h4>
            <p class="field-group-subtitle">First step that reduces risk</p>
          </div>
          <label for="containDesc">Contain the issue</label>
          <input type="text" id="containDesc" placeholder="" />
          <div class="field-subtext-container">
            <button type="button" class="field-subtext-trigger" aria-label="Example: Contain the issue" aria-describedby="containDesc-subtext">
              <span aria-hidden="true">?</span>
            </button>
            <span id="containDesc-subtext" class="field-subtext" role="tooltip">Example: Shift traffic from AZ-3 to stop error propagation.</span>
          </div>
        </div>
      </div>
    </div>
    <!-- [section:impact] end -->

    <div class="drawer-placeholder" aria-hidden="true"></div>

    <!-- KT IS / IS NOT analysis table driven by ROWS tokens. -->
    <!-- [section:table] start -->
    <h3 class="kt-section-title" id="kt-is-is-not">Problem Analysis</h3>
    <div class="kt-focus-toggle" role="radiogroup" aria-label="KT table focus mode">
      <button type="button" role="radio" data-focus-mode="rapid">Rapid</button>
      <button type="button" role="radio" data-focus-mode="focused">Focused</button>
      <button type="button" role="radio" data-focus-mode="comprehensive">Comprehensive</button>
    </div>

    <table id="ktTable" aria-label="KT IS / IS NOT intake table">
<colgroup>
  <col style="width:18%;">
  <col style="width:21%;">
  <col style="width:21%;">
  <col style="width:20%;">
  <col style="width:20%;">
</colgroup>

      <thead>
        <tr>
          <th scope="col">KT Question</th>
          <th scope="col">IS <span class="subtle">— facts only</span></th>
          <th scope="col">IS NOT <span class="subtle">— similar &amp; reasonable and could be but is not occuring</span></th>
          <th scope="col">Distinctions <span class="subtle">— Unique characteristics about the IS</span></th>
          <th scope="col">Changes <span class="subtle">— Changes that happened in on around or about each Distinction</span></th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <!-- [section:table] end -->


    <div id="possible-causes" tabindex="-1"></div>
    <div class="card" id="possibleCausesCard">
      <h3>Possible Causes</h3>
      <p class="caption">Capture hypotheses and pressure test them against the KT IS / IS NOT evidence. Start with the suspect, accusation, and impact; then walk each cause through the table.</p>
      <div id="causeList" class="cause-list" aria-live="polite"></div>
      <div class="cause-controls">
        <button type="button" class="btn-mini" id="addCauseBtn">Add Possible Cause</button>
      </div>
    </div>


    <!-- Summary card showing the most recent export for manual copy. -->
    <!-- [section:summary] start -->
    <div class="card" id="summaryCard" style="display:none;">
      <h3>Copy &amp; Paste Summary</h3>
      <pre id="summaryPre" style="white-space:pre-wrap;font:13px/1.6 monospace;margin:0;"></pre>
    </div>
    <!-- [section:summary] end -->

  </div>

  <div class="comms-backdrop" id="commsBackdrop" aria-hidden="true"></div>
  <aside class="comms-drawer" id="commsDrawer" role="dialog" aria-modal="true" aria-labelledby="commsDrawerTitle" aria-hidden="true" tabindex="-1">
    <div class="comms-drawer__panel">
      <header class="comms-drawer__header">
        <div class="comms-drawer__title-group">
          <h2 class="comms-drawer__title" id="commsDrawerTitle">Bridge &amp; Communications</h2>
          <p class="comms-drawer__subtitle">Stamp bridge details, set cadence, and log incident updates.</p>
        </div>
        <button type="button" class="comms-drawer__close-btn" id="commsCloseBtn">Close</button>
      </header>
      <div class="comms-drawer__body">
        <section class="card comms-card">
          <h3>Bridge Activation</h3>
          <p class="caption">Capture only what’s needed to activate the bridge and set comms cadence.</p>
          <div class="grid cols-3">
            <div class="field">
              <label for="bridgeOpenedUtc">Bridge opened (UTC)</label>
              <div class="inline">
                <input type="text" id="bridgeOpenedUtc" readonly aria-readonly="true" />
                <button type="button" class="btn-mini" id="bridgeSetNowBtn" aria-label="Stamp bridge opened time">Set Now</button>
              </div>
            </div>
            <div class="field">
              <label for="icName">Incident Commander</label>
              <input type="text" id="icName" placeholder="" />
            </div>
            <div class="field">
              <label for="bcName">Broadscope Captain</label>
              <input type="text" id="bcName" placeholder="" />
            </div>
          </div>
          <div class="grid cols-3">
            <div class="field">
              <label for="semOpsName">SEM/Ops Lead</label>
              <input type="text" id="semOpsName" placeholder="" />
            </div>
            <div class="field">
              <label for="severity">Severity</label>
              <select id="severity">
                <option value="">Select severity</option>
                <option value="S1">S1</option>
                <option value="S2">S2</option>
                <option value="S3">S3</option>
              </select>
            </div>
          </div>
        </section>
        <section class="card comms-card" id="commControlsCard">
          <h3>Communication Cadence &amp; Log</h3>
          <fieldset class="field" id="communication-cadence">
            <legend id="commCadenceLegend">Communication cadence</legend>
            <div class="cadence-group" id="commCadenceGroup" role="radiogroup" aria-labelledby="commCadenceLegend">
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="10" />
                <span>10 min</span>
              </label>
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="15" />
                <span>15 min</span>
              </label>
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="20" />
                <span>20 min</span>
              </label>
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="30" />
                <span>30 min</span>
              </label>
              <label class="cadence-option">
                <input type="radio" name="commCadence" value="60" />
                <span>Hourly</span>
              </label>
            </div>
            <small>Pick how often updates should be broadcast. Logging a communication restarts the timer and reminder.</small>
          </fieldset>
          <div class="inline comm-actions">
            <button type="button" class="btn-mini" id="commInternalStampBtn" aria-label="Log internal communication">Log internal update</button>
            <button type="button" class="btn-mini" id="commExternalStampBtn" aria-label="Log external communication">Log external update</button>
            <button type="button" class="btn-mini" id="generateAiSummaryBtn" aria-label="Generate AI Summary">Generate AI Summary</button>
            <span class="countdown" id="commCountdown" aria-live="polite"></span>
          </div>
          <div class="comm-alert" id="commDueAlert" role="alert" hidden></div>
          <div class="grid comm-grid comm-grid--single">
            <div class="field">
              <label for="commNextUpdateTime">Next update scheduled for</label>
              <input type="time" id="commNextUpdateTime" />
            </div>
          </div>
          <div class="field" id="communication-log">
            <label for="commLogList">Communication log</label>
            <ul id="commLogList" class="comm-log" aria-live="polite" aria-label="Communication log"></ul>
            <button type="button" class="btn-mini comm-log-toggle" id="commLogToggleBtn" hidden aria-expanded="false">Show all</button>
          </div>
        </section>
      </div>
    </div>
  </aside>

  <div class="steps-backdrop" id="stepsBackdrop" aria-hidden="true"></div>
  <aside class="steps-drawer" id="stepsDrawer" role="dialog" aria-modal="true" aria-labelledby="stepsDrawerTitle" aria-hidden="true" tabindex="-1">
    <div class="steps-drawer__panel">
      <header class="steps-drawer__header">
        <div class="steps-drawer__title-row">
          <h3 class="steps-drawer__title" id="stepsDrawerTitle">Incident Steps</h3>
          <div class="steps-drawer__progress" id="stepsDrawerProgress">0 of 28 completed</div>
        </div>
      </header>
      <div class="steps-drawer__body" id="stepsList" role="group" aria-label="Incident steps checklist"></div>
      <footer class="steps-drawer__footer">
        <button type="button" class="steps-drawer__close-btn" id="stepsCloseBtn">Close</button>
      </footer>
    </div>
  </aside>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- Script: data models, event wiring, summary export, and persistence helpers. -->
<!-- [script] start -->
<!-- [script] extracted to main.js -->
<!-- [script] end -->
  <!-- External JavaScript -->
  <script type="module" src="main.js"></script>
</body>
</html>
