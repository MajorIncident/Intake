name: Template Manifest Guard (README template-manifest enforcement)

on:
  push:
  pull_request:

jobs:
  template-manifest:
    name: Ensure template manifest file is committed
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Rebuild template manifest
        run: npm run build:templates

      - name: Verify template manifest has no uncommitted changes
        run: |
          STATUS="$(git status --short src/templates.manifest.js)"
          if [ -n "$STATUS" ]; then
            echo "$STATUS"
            echo "src/templates.manifest.js must be regenerated and committed via npm run build:templates."
            exit 1
          fi
